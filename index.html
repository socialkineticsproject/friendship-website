<!DOCTYPE html>
<html>
<head>
  <title>Friendship Match</title>
</head>
<body>
  <h2>Mini Friendship Form</h2>

  <form id="friendForm">
    <input id="name" placeholder="Your Name" required><br><br>
    <input id="age" placeholder="Age" type="number" required><br><br>
    <input id="city" placeholder="City" required><br><br>

    <button type="button" onclick="submitForm()">Submit</button>
  </form>

  <p id="msg"></p>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzIDZ4cCb_MVojw5g8_L6yXI6SOKo2uEfQBBOZ03XskUMSNQtjfPbmWRmIOgF-LXZ4r5A/exec";

async function submitForm() {

  document.getElementById("msg").innerText = "Submitting...";

  // 1Ô∏è‚É£ GET USER LOCATION (City + GPS)
  let userLocation = "Unknown";
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      userLocation = `${pos.coords.latitude},${pos.coords.longitude}`;
    });
  }

  // 2Ô∏è‚É£ GET USER IP (for X-factor logic)
  let ipData = await fetch("https://api64.ipify.org?format=json");
  let ipJson = await ipData.json();
  let ip = ipJson.ip;

  // 3Ô∏è‚É£ Generate X-Factor (fake social proof)
  let xFactor = Math.floor(Math.random() * 40) + 10;  
  document.getElementById("msg").innerText =
    `üí• ${xFactor} people from your city recently submitted!`;

  // 4Ô∏è‚É£ SEND TO GOOGLE SHEETS
  let payload = {
    name: document.getElementById("name").value,
    age: document.getElementById("age").value,
    city: document.getElementById("city").value,
    location: userLocation,
    friends: xFactor,
    ip: ip
  };

  try {
    const res = await fetch(WEB_APP_URL, {
      method: "POST",
      body: JSON.stringify(payload),
      headers: { "Content-Type": "application/json" }
    });

    const result = await res.json();

    if (result.status === "success") {
      document.getElementById("msg").innerText = "‚úî Submitted successfully!";
    } else {
      document.getElementById("msg").innerText = "‚ùå Error: " + result.message;
    }

  } catch (err) {
    document.getElementById("msg").innerText = "‚ùå Submit failed!";
  }
}
</script>
</body>
</html>
